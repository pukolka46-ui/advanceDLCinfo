document.addEventListener('DOMContentLoaded', () => {

  // --- ÐšÐ½Ð¾Ð¿ÐºÐ¸ ---
  const supportBtn = document.getElementById('supportBtn');
  const aboutBtn = document.getElementById('aboutBtn');
  const buyBtn = document.getElementById('buyBtn');
  const cabinetBtn = document.getElementById('cabinetBtn');
  const themeBtn = document.getElementById('themeBtn');
  const topBtn = document.getElementById('topBtn');

  // ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ°, Ñ‡Ñ‚Ð¾ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ñ‹ Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾ ÐµÑÑ‚ÑŒ
  if (supportBtn) supportBtn.addEventListener('click', () => alert('ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° ÑÐºÐ¾Ñ€Ð¾!'));
  if (aboutBtn) aboutBtn.addEventListener('click', () => {
    document.getElementById('about').scrollIntoView({behavior: 'smooth'});
  });
  if (buyBtn) buyBtn.addEventListener('click', () => {
    document.getElementById('plans').scrollIntoView({behavior: 'smooth'});
  });
  if (cabinetBtn) cabinetBtn.addEventListener('click', () => alert('Ð›Ð¸Ñ‡Ð½Ñ‹Ð¹ ÐºÐ°Ð±Ð¸Ð½ÐµÑ‚ Ð¿Ð¾ÐºÐ° Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½.'));
  
  // --- Ð¡Ð¼ÐµÐ½Ð° Ñ‚ÐµÐ¼Ñ‹ ---
  let themeIndex = 4; // ÑÑ‚Ð°Ñ€Ñ‚Ð¾Ð²Ð°Ñ Ñ‚ÐµÐ¼Ð°
  if (themeBtn) themeBtn.addEventListener('click', () => {
    themeIndex++;
    if (themeIndex > 4) themeIndex = 1;
    document.body.className = `theme${themeIndex}`;
  });

  // --- Back-to-top ---
  if (topBtn) {
    topBtn.addEventListener('click', () => {
      window.scrollTo({top: 0, behavior: 'smooth'});
    });
  }

  // --- Typewriter Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ° ---
  const heading = document.getElementById('heading');
  const headingText = "AdvanceLoaderV3 online ðŸš€";
  let idx = 0;
  function typeWriter() {
    if (idx < headingText.length) {
      heading.textContent += headingText[idx];
      idx++;
      setTimeout(typeWriter, 50);
    }
  }
  typeWriter();

  // --- ÐšÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ¸ Ð¿Ð°Ñ€Ð°Ð»Ð»Ð°ÐºÑ ---
  window.addEventListener('scroll', () => {
    document.querySelectorAll('.card').forEach(card => {
      const speed = card.dataset.speed || 0.05;
      const offset = window.scrollY * speed;
      card.style.transform = `translateY(${offset}px) rotateY(10deg)`;
    });

    if (topBtn) topBtn.style.display = window.scrollY > 200 ? 'block' : 'none';
  });

  // --- Fade in About ---
  const aboutText = document.getElementById('about-text');
  if (aboutText) aboutText.style.opacity = 0;
  window.addEventListener('scroll', () => {
    if (aboutText && aboutText.getBoundingClientRect().top < window.innerHeight - 100) {
      aboutText.style.opacity = 1;
    }
  });

  // --- Canvas Ñ‡Ð°ÑÑ‚Ð¸Ñ†Ñ‹ ---
  const canvas = document.getElementById('bgCanvas');
  if (canvas) {
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    let particles = [];
    for (let i = 0; i < 120; i++) {
      particles.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        r: Math.random() * 2 + 1,
        dx: (Math.random() - 0.5) * 0.5,
        dy: (Math.random() - 0.5) * 0.5
      });
    }
    function animateParticles() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      particles.forEach(p => {
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
        ctx.fillStyle = "rgba(187,134,252,0.7)";
        ctx.fill();
        p.x += p.dx;
        p.y += p.dy;
        if (p.x > canvas.width) p.x = 0;
        if (p.x < 0) p.x = canvas.width;
        if (p.y > canvas.height) p.y = 0;
        if (p.y < 0) p.y = canvas.height;
      });
      requestAnimationFrame(animateParticles);
    }
    animateParticles();
    window.addEventListener('resize', () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    });
  }

  // --- Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° ---
  function animateStat(id, target, progId) {
    let el = document.getElementById(id);
    let prog = document.getElementById(progId);
    if (!el || !prog) return;
    let count = 0;
    let step = Math.ceil(target / 100);
    let interval = setInterval(() => {
      count += step;
      if (count >= target) { count = target; clearInterval(interval); }
      el.textContent = count;
      prog.style.width = `${(count / target) * 100}%`;
    }, 20);
  }
  animateStat('stat-clients', 100, 'prog-clients');
  animateStat('stat-purchases', 50, 'prog-purchases');
  animateStat('stat-trust', 20, 'prog-trust');

});
